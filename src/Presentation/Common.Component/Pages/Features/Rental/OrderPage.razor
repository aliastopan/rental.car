@page "/order/{CarId:int}"

@using Domain.Models
@using Infrastructure.Services
@inject FileManager FileManager

<PageTitle>Order</PageTitle>

<EditForm Model="@Order" OnValidSubmit="@SendOrder">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <div class="__container bg-light">
        <InputText
            id="fullname"
            class="form-control __gap"
            placeholder="Nama Lengkap"
            @bind-Value="Order.FullName">
        </InputText>
        <InputText
            id="contact"
            class="form-control __gap"
            placeholder="Contact WhatsApp"
            @bind-Value="Order.ContactNumber">
        </InputText>
        <label for="picture-profile">Unggah KTP</label>
        <InputFile
            id="unggah-ktp"
            class="form-control __gap"
            OnChange="@OnInputFileChange">
        </InputFile>
        <button
            class="btn btn-primary __gap"
            @onclick="UploadFile"
            type="submit">Order
        </button>
    </div>
</EditForm>



@code{

    [ParameterAttribute]
    public int CarId { get; set; }
    public Order Order { get; set; } = new Order();
    private int rentDuration;
    private IBrowserFile? file;
    private string subfolder = $"images/ktp";

    private void OnInputFileChange(InputFileChangeEventArgs e)
    {
        file = e.File;
        Order.KTP = FileManager.GetFilePath(file, subfolder);
    }

    public void RentDurationCalc()
    {
        System.Console.WriteLine($"Date Depart: {Order.DateDepart}");
        System.Console.WriteLine($"Date Return: {Order.DateReturn}");
        int duration = Order.RentDuration;
        rentDuration = duration >= 0 ? duration : 0;
    }

    private void UploadKTP()
    {

    }

    private void SendOrder()
    {

    }

    private async Task UploadFile()
    {
        if(file is not null)
        {
            await FileManager!.UploadAsync(file, subfolder);
        }
    }
}